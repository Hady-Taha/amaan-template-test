<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="dark">

<head>
	<meta charset="utf-8">
	<title>Amman Stream Player v2</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" type="image/x-icon" href="./img/logo.png">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="./js/amaan.js"></script>
</head>

<body class="bg-black text-light d-flex flex-column align-items-center justify-content-center py-5">

	<div class="container text-center">
		<h2 class="mb-4">üé¨ <span style="color: #6351ff;">Amman</span> Stream Player</h2>

		<div class="mb-3 w-100" style="max-width: 500px; margin:auto;">
			<label for="videoUid" class="form-label">Video UID</label>
			<input type="text" id="videoUid" class="form-control text-center" placeholder="Enter Video UUID"
				value="f41b809b-8337-4cfe-acf6-f830dda958f4">
		</div>

		<div class="mb-3 w-100" style="max-width: 500px; margin:auto;">
			<label for="apiKey" class="form-label">API Key</label>
			<input type="text" id="apiKey" class="form-control text-center"
				value="abozaid_a732c2dda617404da6d54d50a891e888">
		</div>

		<button id="generateBtn" class="btn btn-primary px-4 mt-2">Generate OTP & Play</button>

		<div id="status" class="mt-3 text-info"></div>

		<div class="py-5 d-flex justify-content-center align-items-center w-100">
			<div class="ratio ratio-16x9" style="max-width: 720px; width: 100%;">
				<iframe id="videoFrame" allow="autoplay; fullscreen; encrypted-media"
					sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
					style="border:none; display:none;">
				</iframe>
			</div>
		</div>
	</div>

	<script>
		const wid = "01030265229"; // viewer ID (static) // https://test.easy-stream.net
		const base_url = 'https://api2.amaan-stream.com'
		document.getElementById("generateBtn").addEventListener("click", async () => {
			const videoUid = document.getElementById("videoUid").value.trim();
			const apiKey = document.getElementById("apiKey").value.trim();
			const status = document.getElementById("status");
			const iframe = document.getElementById("videoFrame");

			if (!videoUid) {
				status.textContent = "‚ö†Ô∏è Please enter a video UID.";
				return;
			}
			if (!apiKey) {
				status.textContent = "‚ö†Ô∏è Please enter an API key.";
				return;
			}

			status.textContent = "‚è≥ Generating OTP...";
			iframe.style.display = "none";

			try {
				const response = await fetch(`${base_url}/api/video/generate-otp/${videoUid}/`, {
					method: "POST",
					headers: {
						"Authorization": `api-key ${apiKey}`,
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						wid
					})
				});

				if (!response.ok) {
					throw new Error(`Server returned ${response.status}`);
				}

				const data = await response.json();
				const otp = data.otp;
				const playbackInfo = data.playbackInfo;

				iframe.src =
					`${base_url}/player/video/?otp=${encodeURIComponent(otp)}&playbackInfo=${encodeURIComponent(playbackInfo)}`;
				iframe.style.display = "block";
				status.textContent = "‚úÖ Video loaded successfully!";
			} catch (error) {
				console.error(error);
				status.textContent = `‚ùå Error: ${error.message}`;
			}
		});
	</script>

	<script>
		const iframe = document.querySelector('iframe');
		const player = AmaanPlayer.getInstance(iframe);
		// All DOM API supports on player.video
		player.addEventListener("metadata", () => {
			player.getDuration().then((duration) => {
				console.log("Duration:", duration);
			});
		});

		player.addEventListener("time", (data) => {
			console.log("Current time:", data.time);
		});
		// Example quartile listener
	</script>
</body>

</html>